

**SYN 消息（全称 **Synchronize Sequence Numbers**，同步序列号）是 TCP 协议中**控制位（Flag）为 SYN=1** 的报文段。它在 TCP 连接建立的过程中扮演最关键的角色。

简单来说：  
**SYN 消息就是“我想和你建立连接”的信号**。

### SYN 消息的核心作用

1. **发起 TCP 连接**（三次握手中的第1步和第2步都要用到 SYN）
2. **协商双方的初始序列号（Initial Sequence Number, ISN）**  
   这是 TCP 可靠传输的基础，每个方向的数据字节都会基于这个初始序号进行编号。

### SYN 报文的主要特征

| 字段              | 值 / 说明                                      |
|-------------------|-----------------------------------------------|
| SYN 标志位        | 1（置位）                                      |
| ACK 标志位        | 在第一次 SYN 时为 0；在第二次 SYN-ACK 时为 1   |
| 序列号（Seq）     | 发送方随机生成的初始序列号 ISN（例如 Seq=x）   |
| 确认号（Ack）     | 第一次 SYN 时无效（ACK=0）；第二次 SYN-ACK 时 = 对方 Seq + 1 |
| 常用选项          | MSS（最大段大小）、Window Scale、SACK Permitted、Timestamp 等 |

### 三次握手中 SYN 消息的实际例子

假设客户端 IP 192.168.1.10，服务器 10.0.0.5，服务器监听 80 端口。

1. **第一次握手（客户端 → 服务器）**  
   → 纯 SYN 消息  
   ```
   Seq   = 12345678        （客户端随机初始序号）
   Ack   = 0               （还没有要确认的）
   Flags = SYN
   选项  = MSS= MSS 1460, Window Scale 8, SACK OK...
   ```

2. **第二次握手（服务器 → 客户端）**  
   → SYN + ACK 消息（常称为 SYN-ACK）  
   ```
   Seq   = 88888888        （服务器自己的随机初始序号）
   Ack   = 12345679        （= 客户端 Seq + 1，告诉客户端“我已收到你的 SYN”）
   Flags = SYN, ACK
   选项  = MSS 1440...
   ```

3. **第三次握手（客户端 → 服务器）**  
   → 纯 ACK（不再需要 SYN）  
   ```
   Seq   = 12345679
   Ack   = 88888889        （= 服务器 Seq + 1）
   Flags = ACK
   ```

至此，TCP 连接正式建立，可以开始传输数据。

### 为什么需要 SYN？

- 防止历史连接干扰

TCP 的初始序列号是随机生成的（而不是从 0 开始），正是为了防止网络中残留的“历史旧连接”的数据包被新连接误认为是有效数据。SYN 消息里携带的这个随机 ISN 是实现这一安全机制的关键。

### 常见的 SYN 相关攻击

- **SYN Flood 攻击**：攻击者大量发送只含 SYN 的报文但不完成第三次握手，导致服务器维护大量“半连接”而耗尽资源。

### 总结一句话

**SYN 消息就是 TCP 用来“敲门”并协商初始序列号的特殊报文，是建立每一条 TCP 连接都必须的第一步（以及第二步的回应）。**

如果你用 Wireshark 抓包，看到 Flags 列里出现 **S** 或 **[S.]**、**[S,A]**，那就是 SYN 或 SYN-ACK 消息。