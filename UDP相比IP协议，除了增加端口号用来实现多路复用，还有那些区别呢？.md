UDP（用户数据报协议）相比 IP 协议，除了增加**端口号**来实现多路复用（将数据交给特定的应用程序）之外，主要区别集中在以下两个方面：**协议层次**和**头部字段的唯一功能**。

---

## 层次和功能的主要区别

| 区别点 | IP 协议 (网络层 L3) | UDP 协议 (传输层 L4) |
| :--- | :--- | :--- |
| **层次** | 位于 **网络层**。 | 位于 **传输层**，运行在 IP 之上。 |
| **寻址范围** | 负责**主机到主机**的寻址（使用 **IP 地址**）。 | 负责**进程到进程**的寻址（使用 **端口号**）。 |
| **主要职责** | 负责 **路由**，将数据包跨网络从源主机送到目标主机。 | 负责将数据交付给目标主机上的**正确应用程序**。 |
| **头部校验** | 仅包含 **头部校验和**，只检查 IP 头部是否损坏。 | 包含 **UDP 校验和**，可选择性地检查 **整个数据报**（头部和数据）是否损坏。 |
| **长度字段** | 包含 **总长度**，指示整个 IP 数据报的长度。 | 包含 **长度**，指示整个 UDP 用户数据报的长度。 |

---

## 字段层面的具体差异

### 1. 🔍 校验和（Checksum）的范围和目的

这是 UDP 相较于 IP 最重要的区别之一：

* **IP 头部校验和**: 只有 **16 位**，仅用于检查 **IP 头部**在传输过程中是否出现错误。一旦数据包被路由转发，这个校验和就会被重新计算（因为 **TTL** 字段会改变）。
* **UDP 校验和**: 也是 **16 位**，但它（可选地）覆盖了 **UDP 头部** 和 **数据载荷**，以及一个被称为 **伪头部 (Pseudo-header)** 的部分（包含了源和目标 IP 地址等信息）。
    * **作用**: UDP 校验和提供了一种**端到端**的差错检测机制，确保数据在源应用程序和目标应用程序之间传输时没有损坏。由于 IP 协议只校验自己的头部，而数据链路层可能在某些时候禁用校验和，UDP 的这个机制为数据完整性增加了关键保障。

### 2. 📏 长度字段 (Length Field)

* **IP 头部中的总长度**: 表示的是 **整个 IP 数据包**（IP 头部 + 传输层载荷）的字节长度。
* **UDP 头部中的长度**: 表示的是 **整个 UDP 用户数据报**（UDP 头部 + 应用程序数据）的字节长度。

### 3. 🛡️ 协议号 (Protocol Number)

* IP 协议头部中有一个 **协议号** 字段（Protocol），用于指明 **IP 载荷部分**（即 IP 头部后面的数据）是什么传输层协议。
    * 对于 UDP 数据报，该字段的值是 **17**。
    * 这个字段是 IP 协议用于**向上交付**数据到正确的传输层协议栈（如 UDP 或 TCP）的关键。 

[Image of UDP header format and IP header protocol field]


总而言之，IP 协议只负责宏观的**网络跳转**，而 UDP 协议则负责微观的**应用程序交付**和**数据完整性初检**。